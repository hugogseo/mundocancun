import Image from "next/image"
import Link from "next/link"
import { Shield, Clock, Award, HeadphonesIcon } from "lucide-react"
import { Navbar } from "@/components/navbar"
import { Footer } from "@/components/footer"
import { SearchForm } from "@/components/search-form"
import { CategoryFilter } from "@/components/category-filter"
import { PackageCard } from "@/components/package-card"
import { Button } from "@/components/ui/button"
import { createClient } from "@/lib/supabase/server"
import type { PackageWithDetails } from "@/types/database.types"

async function getHomeData() {
  const supabase = await createClient()

  const [categoriesResult, packagesResult] = await Promise.all([
    supabase.from("cat_categories").select("*").order("name"),
    supabase
      .from("pkg_packages")
      .select(`
        *,
        images:pkg_package_images(*),
        categories:pkg_package_tags(category:cat_categories(*))
      `)
      .eq("status", "published")
      .order("created_at", { ascending: false })
      .limit(6),
  ])

  const packages = (packagesResult.data || []).map((pkg) => ({
    ...pkg,
    categories: pkg.categories?.map((t: any) => t.category).filter(Boolean) || [],
  })) as PackageWithDetails[]

  return {
    categories: categoriesResult.data || [],
    packages,
  }
}

export default async function HomePage() {
  const { categories, packages } = await getHomeData()

  return (
    <div className="min-h-screen">
      <Navbar />

      {/* Hero Section */}
      <section className="relative h-[100vh] flex items-center justify-center overflow-hidden">
        <Image
          src="https://images.unsplash.com/photo-1506929562872-bb421503ef21?w=1920&q=80"
          alt="Cancún Beach"
          fill
          className="object-cover"
          priority
        />
        <div className="absolute inset-0 bg-black/50" />

        <div className="relative z-10 container mx-auto px-4 md:px-6 lg:px-8">
          <div className="text-center text-white mb-8 md:mb-12">
            <h1 className="font-display text-5xl md:text-6xl lg:text-7xl xl:text-8xl font-bold mb-4 md:mb-6 tracking-tight">
              Explore The World
            </h1>
            <p className="text-lg md:text-xl lg:text-2xl text-white/95 max-w-3xl mx-auto font-light">
              Paquetes exclusivos a Cancún y la Riviera Maya
            </p>
          </div>

          <SearchForm />
        </div>
      </section>

      {/* Most Visit Section */}
      <section className="py-16 md:py-20 lg:py-24 bg-slate-50/50">
        <div className="container mx-auto px-4 md:px-6 lg:px-8">
          <div className="text-center mb-12 md:mb-16">
            <h2 className="font-display text-3xl md:text-4xl lg:text-5xl font-bold mb-3 md:mb-4">Destinos Más Visitados</h2>
            <p className="text-base md:text-lg text-muted-foreground max-w-2xl mx-auto">
              Explora nuestros destinos favoritos seleccionados por nuestros expertos
            </p>
          </div>

          <CategoryFilter categories={categories} />
        </div>
      </section>

      {/* Benefits Section */}
      <section className="py-16 md:py-20 lg:py-24 bg-white">
        <div className="container mx-auto px-4 md:px-6 lg:px-8">
          <div className="grid gap-8 md:gap-10 lg:gap-12 md:grid-cols-2 lg:grid-cols-4">
            {[
              {
                icon: Shield,
                title: "Reserva Segura",
                description: "Pagos protegidos y certificados",
              },
              {
                icon: Award,
                title: "Mejor Precio",
                description: "Garantía del mejor precio del mercado",
              },
              {
                icon: Clock,
                title: "Soporte 24/7",
                description: "Asistencia en todo momento",
              },
              {
                icon: HeadphonesIcon,
                title: "Asesoría Experta",
                description: "Especialistas en el Caribe",
              },
            ].map((benefit, index) => (
              <div key={index} className="text-center p-6 md:p-8 rounded-2xl bg-slate-50/50 hover:shadow-lg transition-shadow duration-300">
                <div className="inline-flex items-center justify-center w-14 h-14 md:w-16 md:h-16 rounded-full bg-primary/10 mb-4 md:mb-6">
                  <benefit.icon className="h-7 w-7 md:h-8 md:w-8 text-primary" />
                </div>
                <h3 className="text-lg md:text-xl font-semibold mb-2">{benefit.title}</h3>
                <p className="text-sm md:text-base text-muted-foreground">{benefit.description}</p>
              </div>
            ))}
          </div>
        </div>
      </section>

      {/* Gallery Section */}
      <section className="py-16 md:py-20 lg:py-24 bg-slate-50/50">
        <div className="container mx-auto px-4 md:px-6 lg:px-8">
          <div className="text-center mb-12 md:mb-16">
            <h2 className="font-display text-3xl md:text-4xl lg:text-5xl font-bold mb-4">Galería de Experiencias</h2>
          </div>

          <div className="grid gap-4 md:gap-5 lg:gap-6 md:grid-cols-3 lg:grid-cols-4">
            {[1, 2, 3, 4, 5, 6, 7, 8].map((i) => (
              <div key={i} className="relative h-56 md:h-64 lg:h-72 rounded-2xl overflow-hidden group shadow-md hover:shadow-xl transition-all duration-300">
                <Image
                  src={`https://images.unsplash.com/photo-${1500000000000 + i * 100000}?w=600&q=80`}
                  alt={`Gallery ${i}`}
                  fill
                  className="object-cover group-hover:scale-110 transition-transform duration-500"
                />
              </div>
            ))}
          </div>
        </div>
      </section>

      {/* Packages Section */}
      <section className="py-16 md:py-20 lg:py-24 bg-white">
        <div className="container mx-auto px-4 md:px-6 lg:px-8">
          <div className="text-center mb-12 md:mb-16">
            <h2 className="font-display text-3xl md:text-4xl lg:text-5xl font-bold mb-3 md:mb-4">Paquetes Destacados</h2>
            <p className="text-base md:text-lg text-muted-foreground max-w-2xl mx-auto">
              Ofertas especiales cuidadosamente seleccionadas para ti
            </p>
          </div>

          <div className="grid gap-6 md:gap-8 lg:gap-10 md:grid-cols-2 lg:grid-cols-3 mb-12 md:mb-16">
            {packages.map((pkg, index) => (
              <PackageCard key={pkg.id} package={pkg} index={index} />
            ))}
          </div>

          <div className="text-center">
            <Button asChild size="lg" variant="outline" className="h-12 px-8 rounded-xl">
              <Link href="/packages">Ver Todos los Paquetes</Link>
            </Button>
          </div>
        </div>
      </section>

      {/* CTA Contact Section */}
      <section className="relative py-24 md:py-32 lg:py-40 overflow-hidden">
        <Image
          src="https://images.unsplash.com/photo-1499793983690-e29da59ef1c2?w=1920&q=80"
          alt="Contact"
          fill
          className="object-cover"
        />
        <div className="absolute inset-0 bg-gradient-to-r from-primary/85 to-blue-600/85" />

        <div className="relative z-10 container mx-auto px-4 md:px-6 lg:px-8 text-center text-white">
          <h2 className="font-display text-3xl md:text-4xl lg:text-5xl xl:text-6xl font-bold mb-4 md:mb-6">
            ¿Listo para tu próxima aventura?
          </h2>
          <p className="text-lg md:text-xl lg:text-2xl mb-8 md:mb-10 max-w-2xl mx-auto font-light">
            Contáctanos y diseñaremos el viaje perfecto para ti
          </p>
          <div className="flex gap-4 justify-center flex-wrap">
            <Button asChild size="lg" variant="secondary" className="h-12 px-8 rounded-xl shadow-lg">
              <Link href="/contact">Contáctanos</Link>
            </Button>
            <Button asChild size="lg" variant="outline" className="h-12 px-8 rounded-xl bg-transparent text-white border-2 border-white hover:bg-white hover:text-primary shadow-lg">
              <Link href="/packages">Ver Paquetes</Link>
            </Button>
          </div>
        </div>
      </section>

      <Footer />
    </div>
  )
}
